# -*- coding: utf-8 -*-
import pefile
import lief
import logging
import collections

mylogger = logging.getLogger(__name__)
sh = logging.StreamHandler()
mylogger.addHandler(sh)
mylogger.setLevel(logging.DEBUG)

def get_count_suspicious_sections(pe):
    '''
    악성코드에서 자주 출현하는 섹션의 유/무
    '''

    try:
        malicious_sections = collections.OrderedDict({
            '.text': 0,
            '.data': 0,
            '.rdata': 0,
            '.idata': 0,
            '.rsrc': 0,
            '.bss': 0,
            '.crt': 0,
            '.tls': 0
        })

        for section in pe.sections:
            section_name = section.Name.decode('utf-8')
            section_name = section_name.split('\00')[0].lower()

            # 섹션 이름이 있으면 딕셔너리 값을 1로 수정
            if section_name in malicious_sections:
                malicious_sections[section_name] = 1

        return malicious_sections

    except Exception as e:
        mylogger.debug('get_count_suspicious_section is failed')
        return None