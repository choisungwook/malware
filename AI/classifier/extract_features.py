#-*- coding: utf-8 -*-
#import raw_features
import pefile
import sys
import logging
import csv
from src import conf, raw_features

mylogger = logging.getLogger(__name__)
mylogger.setLevel(logging.DEBUG)
ch = logging.StreamHandler()
mylogger.addHandler(ch)

# csv 파일 이름
output = 'test_features.csv'

try:
    pe = pefile.PE(conf.testtarget)

    '''
        PE포맷의 DOS헤더 추출
        실패시 프로그램 종료
    '''
    dos_header = raw_features.extract_dos_header(pe)
    if dos_header is None:
        mylogger.info('Extracting dos_header is failed')
        sys.exit(-1)

    # 추출한 특성을 파일로 쓰기
    with open(output, 'wt') as f:
        writer = csv.writer(f, lineterminator='\n')

        # 헤더 쓰기
        writer.writerow(list(conf.__IMAGE_DOS_HEADER_format__[1]))

        # 추출한 도스헤더 쓰기
        writer.writerow(dos_header.values())

except Exception as e:
    mylogger.info('Load PE is failed')

mylogger.debug('Extracting is finished')