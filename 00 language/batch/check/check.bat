@echo off

secedit /export /cfg LocalSecurityPolicy.txt > NUL

:: W-01 administrator name is exist
net user | findstr /i administrator > NUL

if ERRORLEVEL == 1 (
    echo W-01 safe
) else (
    echo W-01 vulnerability
)

:: W-02 Guset is exist
net user | findstr /i guest > NUL
if ERRORLEVEL == 1 (
    echo W-02 safe
) else (
    echo W-02 vulnerability
)

:: W-03 
echo W-03 Manual Check

:: W-04 threshold of login lock 
:: hangul is not wroking
:: failed code
:: for /f "tokens=*" %%i in ('net accounts') do (
::    echo %%i | findstr "임계값"   
:: )

for /f "tokens=3 delims= " %%i in ('type LocalSecurityPolicy.txt ^| find /i "LockoutBadCount"') do set _result=%%i
echo %_result% | findstr /i "0 1 2 3 4 5" > NUL
if ERRORLEVEL == 1 (
    echo W-04 safe
) else (
    echo W-04 vulnerability
)

:: W-05 password is saved to plain text
secedit /export /cfg LocalSecurityPolicy.txt > NUL
type LocalSecurityPolicy.txt | find /i "ClearTextPassword" | find "0" > NUL
if ERRORLEVEL == 1 (
    echo W-05 vulnerability
) else (
    echo W-05 safe
)

:: W-06 Administrator group
:: do manual check... don't use script
:: command: net localgroup Administrators
echo W-06 Manual Check

:: W-07 everygroup in shared folder
:: do manaul check
:: command: net share
echo W-07 Manual Check

:: W-08 harddisk shared
:: do manaul check
:: command: net share
echo W-08 Manual Check

:: done
del LocalSecurityPolicy.txt