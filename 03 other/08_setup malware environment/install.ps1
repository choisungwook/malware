Write-Host "======= Start the install malware enviorment ======"

# ============================================= 단계1 윈도우10 앱 제거============================================= 
# ===========================================================================================================
# ===========================================================================================================


Get-AppxPackage Microsoft.3DBuilder | Remove-AppxPackage
Get-AppxPackage Microsoft.WindowsAlarms | Remove-AppxPackage
Get-AppxPackage *Autodesk* | Remove-AppxPackage
Get-AppxPackage Microsoft.BingFinance | Remove-AppxPackage
Get-AppxPackage Microsoft.BingNews | Remove-AppxPackage
Get-AppxPackage Microsoft.BingSports | Remove-AppxPackage
Get-AppxPackage Microsoft.BingWeather | Remove-AppxPackage
Get-AppxPackage *BubbleWitch* | Remove-AppxPackage
Get-AppxPackage king.com.CandyCrush* | Remove-AppxPackage
Get-AppxPackage Microsoft.CommsPhone | Remove-AppxPackage
Get-AppxPackage *Dell* | Remove-AppxPackage
Get-AppxPackage *Dropbox* | Remove-AppxPackage
Get-AppxPackage *Facebook* | Remove-AppxPackage
Get-AppxPackage Microsoft.WindowsFeedbackHub | Remove-AppxPackage
Get-AppxPackage Microsoft.Getstarted | Remove-AppxPackage
Get-AppxPackage *Keeper* | Remove-AppxPackage
Get-AppxPackage microsoft.windowscommunicationsapps | Remove-AppxPackage
Get-AppxPackage Microsoft.WindowsMaps | Remove-AppxPackage
Get-AppxPackage *MarchofEmpires* | Remove-AppxPackage
Get-AppxPackage Microsoft.Messaging | Remove-AppxPackage
Get-AppxPackage *Minecraft* | Remove-AppxPackage
Get-AppxPackage *Netflix* | Remove-AppxPackage
Get-AppxPackage Microsoft.MicrosoftOfficeHub | Remove-AppxPackage
Get-AppxPackage Microsoft.OneConnect | Remove-AppxPackage
Get-AppxPackage Microsoft.Office.OneNote | Remove-AppxPackage
Get-AppxPackage Microsoft.People | Remove-AppxPackage
Get-AppxPackage Microsoft.WindowsPhone | Remove-AppxPackage
Get-AppxPackage *Plex* | Remove-AppxPackage
Get-AppxPackage Microsoft.SkypeApp | Remove-AppxPackage
Get-AppxPackage Microsoft.WindowsSoundRecorder | Remove-AppxPackage
Get-AppxPackage *Solitaire* | Remove-AppxPackage
Get-AppxPackage Microsoft.MicrosoftStickyNotes | Remove-AppxPackage
Get-AppxPackage Microsoft.Office.Sway | Remove-AppxPackage
Get-AppxPackage *Twitter* | Remove-AppxPackage
Get-AppxPackage Microsoft.XboxApp | Remove-AppxPackage
Get-AppxPackage Microsoft.XboxIdentityProvider | Remove-AppxPackage
Get-AppxPackage Microsoft.ZuneMusic | Remove-AppxPackage
Get-AppxPackage Microsoft.ZuneVideo | Remove-AppxPackage
Get-AppxPackage *DisneyMagicKingdom* | Remove-AppxPackage
Get-AppxPackage *HiddenCityMysteryofShadows* | Remove-AppxPackage


# ============================================= 단계2 윈도우 설정============================================= 
# ===========================================================================================================
# ===========================================================================================================


# 방화벽 끄기
# 참고자료: https://www.windows-commandline.com/enable-disable-firewall-command-line/
netsh advfirewall set  currentprofile state off

# 윈도우 디펜더 비활성화
# 참고자료: https://www.itechtics.com/enable-disable-windows-defender/
reg add "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d "0x1" /f 

# 윈도우 업데이트 비활성화
# 참고자료: https://docs.microsoft.com/ko-kr/windows/deployment/update/waas-wu-settings
#          https://gist.github.com/JimmyAppelt/1b85b518c7fd44b6742fe2aafa17b646
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" /v NoAutoUpdate /t REG_DWORD /d "0x1" /f 

# 알림센터 비활성화
# 참고자료: https://gist.github.com/OALabs/afb619ce8778302c324373378abbaef5
reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v HideSCAHealth /t REG_DWORD /d "0x1" /f 

# bing 엔진 검색 비활성화
Disable-BingSearch

# 게임바팁 안내 메세지 비활성화
Disable-GameBarTips

# UAC 비활성화: 이 설정은 안하는 편이 좋다고 생각하여 주석
# Disable-UAC


# ============================================= 단계3 분석도구 설치============================================= 
# ===========================================================================================================
# ===========================================================================================================


# 헥사에디터
choco install hxd -y

# 기드라
choco install ghidra -y

# ida free
choco install ida-free -y

# visual studio code
choco install vscode -y

# notepad++
choco install notepadplusplus -y

# 프로세스 모니터
choco install procmon -y

# 프로세스 익스플로러
choco install procexp -y

# 프로세스 해커
choco install processhacker.install -y

# 올리디버거
choco install ollydbg -y

# x64dbg
choco install x64dbg.portable -y

# 아나콘다: 설치 후 재부팅 필요
# 아나콘다가 설치 중에 자동으로 파이썬 3버전도 설치
# 환경변수 설정 참고자료: https://codingbee.net/powershell/powershell-make-a-permanent-change-to-the-path-environment-variable
choco install anaconda3 -y
$oldpath = (Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH).path
$newpath = $oldpath + ";" + "C:\tools\Anaconda3" + ";" + "C:\tools\Anaconda3\Scripts" + ";" + "C:\tools\Anaconda3\Library" + ";" + "C:\tools\Anaconda3\Library\bin"
Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH -Value $newPath

# 파이썬 pip 업데이트
python -m pip install --upgrade pip
pip install --upgrade setuptools

# oletools
pip install oletools

# yara
pip install yara

# Detect it easy
choco install die

# pestudio
choco install pestudio -y